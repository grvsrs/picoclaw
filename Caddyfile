# PicoClaw — Caddy reverse proxy
# Provides automatic HTTPS, WebSocket support, and security headers.
#
# ──────────────────────────────────────────────────────────────────
# OPTION 1: Public internet with a real domain (automatic HTTPS)
# ──────────────────────────────────────────────────────────────────
# 1. Replace yourdomain.com with your domain
# 2. Point DNS A record to this server's public IP
# 3. caddy run --config Caddyfile

# ──────────────────────────────────────────────────────────────────
# OPTION 2: Tailscale (recommended — private, zero port-forwarding)
# ──────────────────────────────────────────────────────────────────
# 1. tailscale up
# 2. Find hostname: tailscale status --json | python3 -c "import sys,json; d=json.load(sys.stdin); print(d['Self']['DNSName'])"
# 3. Enable HTTPS in Tailscale admin (Settings → HTTPS certificates)
# 4. Replace XXXXXXXX below with your Tailnet machine name
#    caddy run --config Caddyfile

# ──────────────────────────────────────────────────────────────────
# OPTION 3: LAN / self-signed (no domain needed)
# ──────────────────────────────────────────────────────────────────
# :443 {
#     tls internal
#     reverse_proxy 127.0.0.1:18790
# }

# ── ACTIVE CONFIG (edit hostname before use) ──────────────────────
# Replace with one of:
#   - yourdomain.com
#   - gs.tail-XXXXXXXX.ts.net   (from: tailscale status --json | python3 -c ...)
yourdomain.com {
    reverse_proxy 127.0.0.1:18790

    header {
        X-Frame-Options DENY
        X-Content-Type-Options nosniff
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
        Referrer-Policy strict-origin-when-cross-origin
        Permissions-Policy "camera=(), microphone=(), geolocation=()"
        -Server
    }

    log {
        output file /var/log/caddy/picoclaw.log
        format json
    }
}
